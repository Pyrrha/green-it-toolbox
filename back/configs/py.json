{
    "name": "default-pipeline",
    "groups": [
        {
            "name": "artefact",
            "jobs": [
                {
                    "name": "compilation",
                    "steps": [
                        {
                            "name": "compile",
                            "command": "make"
                        }
                    ]
                },
                {
                    "name": "docker",
                    "steps": [
                        {
                            "name": "docker-login",
                            "command": "docker login -u USERNAME -p PASSWORD"
                        },
                        {
                            "name": "build-image",
                            "command": "docker build . -t USERNAME/project:latest"
                        },
                        {
                            "name": "publish-image",
                            "command": "docker push USERNAME/project:latest"
                        }
                    ]
                }
            ]
        },
        {
            "name": "staging",
            "jobs": [
                {
                    "name": "deployment-staging",
                    "steps": [
                        {
                            "name": "deploy-staging",
                            "command": "scp docker-compose.yml user@hostname:/path"
                        },
                        {
                            "name": "apply-staging",
                            "command": "ssh user@hostname 'docker stack deploy -c <(docker-compose -f docker-compose.yml config) project'"
                        }
                    ]
                }
            ]
        },
        {
            "name": "production",
            "jobs": [
                {
                    "name": "deployment-production",
                    "steps": [
                        {
                            "name": "deploy-production",
                            "command": "scp docker-compose.yml user@hostname:/path"
                        },
                        {
                            "name": "apply-production",
                            "command": "ssh user@hostname 'docker stack deploy -c <(docker-compose -f docker-compose.yml config) project'"
                        }
                    ]
                }
            ]
        }
    ]
}